# 인증/인가 Security
  + JWT 토큰을 이용한 인증
  + 사용자 역할에 따라 인가 ( ADMIN, USER )
---
## 의도한 구조
  1. 회원가입시 user_id가 admin일 경우에만 role이 ROLE_ADMIN으로 설정, 이외에는 기본적으로 전부 ROLE_USER
  2. 메인 페이지에서 admin-content와 member-content로 구분하여 role이 ROLE_ADMIN 인 관리자 계정만 모두 열람 가능
  3. role이 ROLE_USER인 사용자의 경우 제한된 콘텐츠 열람 시도할시 액세스 거부
---
## 작동 메커니즘
  + TokenProvider 에서 토큰의 생성, 검증, 인증/인가 정보 추출
    + 토큰 생성 : 현재 시간을 가져오고 만료 시간을 계산하여 토큰의 만료 시간을 설정
    + 토큰 검증 : 토큰이 유효한지, 만료되었는지, 잘못된 토큰인지 검증
    + 인증/인가 정보 추출 : 토큰에서 클레임을 추출하여 Member 객체에 빌드하여 반환

  + 로그인 시 토큰이 유효한지 확인하고 만료된 토큰일시 refresh-token을 이용해 재발급
  + 유효한 토큰이라면 해당 토큰을 기반으로 한 사용자 정보 조회
  + 사용자의 Role이 ADMIN인지 USER인지 판별하여 인가 제한
---
## 문제점
  1. 로그인 시 CustomUserDetails 의 Member에 사용자 정보가 저장이 되는 것을 확인했지만 MemberApiController의 getUserInfo 메서드에서 member 객체가 null로 나옴
  2. 로그아웃의 기능은 작동하되 의도한 대로 진행되지 않음
  3. 여러 문제를 해결하기 위해 코드 수정 단계에서 로그인 시 토큰이 만료되었을때의 리디렉션 수행 -> 만료된 토큰을 재발급을 못 하는 것인지 최종적으로 토큰에 정보를 담아오지 못했기 때문에 발생한 문제인지는 위의 문제점 해결 이후 확인 예정
  
